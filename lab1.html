<!DOCTYPE html>
<html lang="en">

<head>
    <script src='https://d3js.org/d3.v7.min.js'></script>
</head>

<body>
    <script>
        // write your d3 code here.. 
        console.log('d3.version:', d3.version);

        // ------------------------ Exercise 1 ------------------------
        // Answer: Version = 7.3.0

    </script>
    <!-- ------------------------ Exercise 2 ------------------------ -->
    <p>First paragraph</p>
    <p>Second paragraph</p>
    <script>
        d3
            .select("p")
            .style("color", "red")
            .style("font-size", "32px")
            .style("line-height", "20px")
            .text("The paragraph below is a liar")
            .style('font-family', "cursive")
    </script>
    <!-- ------------------------ Exercise 3 ------------------------ -->
    <h3>exercise3</h3>
    <script>

        d3
            .select('body')
            .append('div')
            .attr('id', 'exercise3')
            .style('display', 'flex')

        for (let i = 0; i < 10; i++) {

            d3
                .select('#exercise3')
                .append('div')
                .style('width', '30px')
                .style('height', '30px')
                .style('margin', '2px')
                .style('background', () => i > 4 ? 'green' : 'red')
                .style('text-align', 'center')
                .text(i + 1)

        }

    </script>
    <!-- ------------------------ Exercise 4 ------------------------ -->
    <h3>exercise4</h3>
    <script>
        d3
            .select('body')
            .append('div')
            .attr('id', 'exercise4')
            .style('display', 'flex')

        for (let i = 0; i < 10; i++) {

            d3
                .select('#exercise4')
                .append('div')
                .style('width', '30px')
                .style('height', '30px')
                .style('margin', '2px')
                .style('background', () => i > 4 ? 'green' : 'red')
                .style('text-align', 'center')
                .attr('id', `exercise4-div-${i}`)
                .text(i + 1)
        }

        d3
            .select('#exercise4-div-0')
            .style('background', 'purple')
            .text('start')
        d3
            .select('#exercise4-div-1')
            .style('width', '70px')
        d3
            .select('#exercise4-div-2')
            .style('border-radius', '50px')
        d3
            .select('#exercise4-div-3')
            .style('border', '2px solid pink')

        // -----------------------------------------------------------You can do more

    </script>
    <!-- ------------------------ Exercise 5 ------------------------ -->
    <h3>exercise 5</h3>

    <script>
        d3
            .select("body")
            .append("div")
            .attr('id', '#exercise5')
            .text("Hello World!")
            .style('color', 'green')
            .style('font-weight', 'bold');
    </script>

    <!-- ------------------------ Exercise 6 ------------------------ -->
    <h3>excerise 6</h3>

    <script>
        let otherdata = [{ name: 'test', val: 1 },
        { name: 'other', val: 2 },
        { name: 'b', val: 3 },
        { name: 'color', val: 4 }]
            ;

        d3.select('body')
            .append('div')
            .attr('id', 'exercise6')

        for (let i = 0; i < otherdata.length; i++) {
            d3
                .select('#exercise6')
                .append('div')
        }

        d3.select("#exercise6")
            .selectAll("div")
            .data(otherdata)
            .text(function (d, i) {
                console.log("d.name: " + d.name);
                console.log("d.val: " + d.val);
                console.log("i: " + i);
                console.log("this: " + this);
                return 'cont:' + d.name; // return value is used to set the 'text'
            });

    </script>

    <!-- ------------------------ Exercise 7 ------------------------ -->
    <h3>excerise 7</h3>

    <script>
        let num = [10, 50, 100, 200];

        d3.select('body')
            .append('div')
            .attr('id', 'exercise7')

        // Adding 4 divs
        for (let i = 0; i < num.length; i++) {
            d3
                .select('#exercise7')
                .append('div')
        }

        d3.select("#exercise7")
            .selectAll("div")
            .data(num)
            .text(function (d, i) {
                return 'cont:' + d; // return value is used to set the 'text'
            })
            .style("color", function (d, i) {
                if (d > 49 && d < 101) {
                    return "red";
                } else {
                    return "yellow";
                }
                return 'blue';
            });

    </script>

    <!-- ------------------------ Exercise 8 ------------------------ -->
    <h3>excerise 8</h3>

    <script>
        var ex8Data = ['a', 4, 1, 'b', 6, 2, 8, 9, 'z'];

        // Adds a div with an Id excercise8 
        // Adds span inside #exercise8
        d3.select("body")
            .append('div')
            .attr('id', 'exercise8')
            .selectAll("span")
            .data(ex8Data)
            .enter()
            .append('span')
            .style('color', (d) => typeof (d) == 'number' ? 'green' : 'blue')
            .style('font-weight', (d) => typeof (d) == 'number' ? 'bold' : 'regular')
            .text(function (d, i) {
                return d;
            });
    </script>

    <!-- ------------------------ Exercise 9 ------------------------ -->
    <script>
        let ex9csv = 'https://raw.githubusercontent.com/dsindy/kaggle-titanic/master/data/test.csv';
        /*
        PassengerId,Pclass,Name,Sex,Age,SibSp,Parch,Ticket,Fare,Cabin,Embarked
        892,3,"Kelly, Mr. James",male,34.5,0,0,330911,7.8292,,Q
        893,3,"Wilkes, Mrs. James (Ellen Needs)",female,47,1,0,363272,7,,S
        894,2,"Myles, Mr. Thomas Francis",male,62,0,0,240276,9.6875,,Q
        895,3,"Wirz, Mr. Albert",male,27,0,0,315154,8.6625,,S
        */
        let ex9Count = {
            'Below 20': 0,
            'Below 40': 0,
            'Below 60': 0,
            'Above 60': 0,
        }
        d3.csv(ex9csv, function (data) {
            let prefix = data.Name.match(/[A-Za-z]+\./)[0]
            // console.log(prefix)
            ex9Count[prefix] = ex9Count[prefix] == null ? 1 : ex9Count[prefix] + 1
            ex9Count[data.Sex] = ex9Count[data.Sex] == null ? 1 : ex9Count[data.Sex] + 1

            if (data.Age < 20) {
                ex9Count['Below 20']++
            }
            else if (data.Age < 40) {
                ex9Count['Below 40']++
            }
            else if (data.Age < 60) {
                ex9Count['Below 60']++
            }
            else if (data.Age > 60) {
                ex9Count['Above 60']++
            }
        })
            .then(() => {
                d3
                    .select('body')
                    .append('h3')
                    .text('excerise 9')

                const divs = d3
                    .select('body')
                    .append('div')
                    .attr('id', 'exercise9')
                    .style('display', 'flex')
                    .selectAll('div')
                    .data(Object.entries(ex9Count))
                    .enter()
                    .append('div')
                    .style('text-align', 'center')
                    .style('margin', '10px')

                divs
                    .append('h4')
                    .text(d => d[0])
                divs
                    .append('p')
                    .text(d => d[1])

            })

    </script>

    <!-- ------------------------ Exercise 10 ------------------------ -->
    <script>
        let heartfailurecsv = 'https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv';
        /*
        age,anaemia,creatinine_phosphokinase,diabetes,ejection_fraction,high_blood_pressure,platelets,serum_creatini
        ne,serum_sodium,sex,smoking,time,DEATH_EVENT
        75,0,582,0,20,1,265000,1.9,130,1,0,4,1
        55,0,7861,0,38,0,263358.03,1.1,136,1,0,6,1
        65,0,146,0,20,0,162000,1.3,129,1,1,7,1
        50,1,111,0,20,0,210000,1.9,137,1,0,7,1
        */
        let ex10Count = {
            '1-30': 0,
            '31-40': 0,
            '41-60': 0,
            '61-100': 0,
        }

        d3.csv(heartfailurecsv, function (data) {
            //console.log( data.age);
            // todo
            if (data.age < 31) {
                ex10Count['1-30']++
            }
            else if (data.age < 41) {
                ex10Count['31-40']++
            }
            else if (data.age < 61) {
                ex10Count['41-60']++
            }
            else if (data.age < 101) {
                ex10Count['61-100']++
            }
        }).then(() => {
            d3
                .select('body')
                .append('h3')
                .text('excerise 10')

            const divs = d3
                .select('body')
                .append('div')
                .attr('id', 'exercise10')
                .style('display', 'flex')
                .selectAll('div')
                .data(Object.entries(ex10Count))
                .enter()
                .append('div')
                .style('text-align', 'center')
                .style('margin', '10px')

            divs
                .append('h4')
                .text(d => d[0])
            divs
                .append('p')
                .text(d => d[1])

        })

    </script>
    <!-- ------------------------ Exercise 11 ------------------------ -->
    <script>
        //Create SVG element

        d3
            .select('body')
            .append('h3')
            .text('excercise 11')

        var svg = d3.select("body")
            .append("svg")
            .attr("width", 400)
            .attr("height", 400)
            .style("border", '1px solid green');
        //Create line element inside SVG
        svg.append("line")
            .attr("x1", 95)
            .attr("x2", 205)
            .attr("y1", 95)
            .attr("y2", 95)
            .attr("stroke", "blue")
            .attr("stroke-width", '10px')
        svg.append("line")
            .attr("x1", 200)
            .attr("x2", 200)
            .attr("y1", 100)
            .attr("y2", 200)
            .attr("stroke", "pink")
            .attr("stroke-width", '10px')
        svg.append("line")
            .attr("x1", 205)
            .attr("x2", 95)
            .attr("y1", 205)
            .attr("y2", 205)
            .attr("stroke", "purple")
            .attr("stroke-width", '10px')

        svg.append("line")
            .attr("x1", 100)
            .attr("x2", 100)
            .attr("y1", 200)
            .attr("y2", 100)
            .attr("stroke", "orange")
            .attr("stroke-width", '10px')
    </script>
    <!-- ------------------------ Exercise 14 and 15 ------------------------ -->
    <style>
        svg rect {
            fill: blue;
        }

        svg text {
            fill: white;
            font: 10px sans-serif;
            text-anchor: end;
        }
    </style>
    <script>

        let ex14Count = {
            '1-30': 0,
            '31-40': 0,
            '41-60': 0,
            '61-100': 0,
        }

        d3.csv(heartfailurecsv, function (data) {
            //console.log( data.age);
            // todo
            if (data.age < 31) {
                ex14Count['1-30']++
            }
            else if (data.age < 41) {
                ex14Count['31-40']++
            }
            else if (data.age < 61) {
                ex14Count['41-60']++
            }
            else if (data.age < 101) {
                ex14Count['61-100']++
            }
        }).then(() => {
            d3
                .select("body")
                .append("h3")
                .text("exercise 14 & 15")

            d3
                .select("body")
                .append("div")
                .attr("id", "exercise14")

            var data = Object.entries(ex14Count);
            console.log("Data")
            console.log(data)

            var width = 500;
            var scaleFactor = 2;
            var barHeight = 20;

            var graph = d3.select("#exercise14")
                .append("svg")
                .attr("width", width)
                .attr("height", barHeight * data.length);

            var bar = graph.selectAll("g")
                .data(data)
                .enter()
                .append("g")
                .attr("transform", function (d, i) {
                    return "translate(0," + i * barHeight + ")";
                });

            bar.append("rect")
                .attr("width", function (d) {
                    return d[1] * scaleFactor;
                })
                .attr("height", barHeight - 1)
                .attr("x", 100)
                .style('fill', (d) => d[1] > 100 ? "red" : "blue");

            // Title
            bar.append("text")
                .attr("x", 50)
                .attr("y", barHeight / 2)
                .attr("dy", ".35em")
                .style('fill', 'black')
                .style('font-size', '16px')
                .text((d) => d[0]);
            // Amount
            bar.append("text")
                .attr("x", function (d) { return (d[1] * scaleFactor) + 100; })
                .attr("y", barHeight / 2)
                .attr("dy", ".35em")
                .style('fill', 'black')
                .style('font-size', '16px')
                .text((d) => d[1]);


        })
    </script>
    <!-- ------------------------ Exercise 16 ------------------------ -->
    <h3>excercise 16</h3>
    <h4>Odd = Square & Even = Circle</h4>
    <script>
        const ex16width = 600;
        const ex16height = 200;
        const ex16data = [10, 15, 20, 25, 30];
        // Note different valid ways of specifying color
        const colors = ['#ffffcc', 'red', 'rgb(0,255,0)', '#31a354', '#006837'];
        d3.select("body")
            .append('div')
            .attr('id', 'exercise16')
        const ex16svg = d3.select('#exercise16')
            .append("svg")
            .attr("width", ex16width)
            .attr("height", ex16height);
        const ex16g = ex16svg.selectAll("g")
            .data(ex16data)
            .enter()
            .append("g")
            .attr("transform", function (d, i) {
                return "translate(0,0)";
            })

        console.log("Gada")
        console.log(ex16g)

        // if even then draw circle
        ex16g.each(((d, i) => {
            console.log(d)

            if (d % 2 == 0) {
                console.log(true)
                ex16g.append("circle")
                    .attr("cx", function () {
                        return i * 100 + 50 + (d * 1.5);
                    })
                    .attr("cy", function () {
                        return 100;
                    })
                    .attr("r", function () {
                        return d * 1.5;
                    })
                    .attr("fill", function () {
                        return colors[i];
                    })
                return
            } else {
                console.log(false)
                ex16g.append("rect")
                    .attr("x", function () {
                        return i * 100 + 50;
                    })
                    .attr("y", function () {
                        return 100 - (d * 0.7);
                    })
                    .attr("width", function () {
                        return d * 1.5;
                    })
                    .attr("height", function () {
                        return d * 1.5;
                    })
                    .attr("fill", function () {
                        return colors[i];
                    });
            }
        }))
        ex16g.append("text")
            .attr("x", function (d, i) {
                return i * 100 + 40;
            })
            .attr("y", 105)
            .attr("stroke", "teal")
            .attr("font-size", "12px")
            .attr("font-family", "sans-serif")
            .text(function (d) {
                return d;
            });
    </script>

</body>

</html>