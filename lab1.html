<!DOCTYPE html>
<html lang="en">

<head>
    <script src='https://d3js.org/d3.v7.min.js'></script>
</head>

<body>
    <h3>exercise1 & 2</h3>
    <p>First paragraph</p>
    <p>Second paragraph</p>
    <div id='exercise1'></div>
    <div id='exercise2'></div>
    <div id='exercise3'></div>
    <div id='exercise4'></div>
    <div id='exercise5'></div>
    <div id='exercise6'></div>
    <div id='exercise7'></div>
    <div id='exercise8'></div>
    <div id='exercise9'></div>
    <div id='exercise10'></div>
    <div id='exercise11'></div>
    <div id='exercise12'></div>
    <div id='exercise13'></div>
    <div id='exercise14'></div>
    <div id='exercise15'></div>
    <div id='exercise16'></div>
    <div id='exercise17'></div>
    <div id='exercise18'></div>
    <div id='exercise19'></div>
    <div id='exercise20'></div>
    <div id='exercise21'></div>
    <div id='exercise22'></div>
    <div id='exercise23'></div>
    <div id='exercise24'></div>
    <div id='exercise25'></div>
    <div id='exercise26'></div>
    <div id='exercise27'></div>
    <div id='exercise28'></div>
    <div id='exercise29'></div>
    <div id='exercise30'></div>
    <div id='exercise31'></div>
    <div id='exercise32'></div>
    <!-- Functions to be used -->
    <script>
        // Constants
        const heartfailurecsv = 'https://raw.githubusercontent.com/akmand/datasets/master/heart_failure.csv';

        // Add Exercise Div
        const addExerciseDiv = ({ exerciseNumber, flex = false }) => {
            let div = d3
                .select(`#exercise${exerciseNumber}`)

            div
                .append('h3')
                .text(`Exercise ${exerciseNumber}`)
            const exerciseDiv = div.append('div').style('display', flex ? 'flex' : 'block')
            return exerciseDiv
        }
        // Gets the data from Csv
        const getCsv = async (csvUrl) => {
            let data = []
            await d3.csv(csvUrl, (d) => {
                data.push(d);
            })
            return data
        }

        // Gets count from csv
        const getCountFromCSV = (data, condition) => {
            let count = 0;
            data.forEach((row) => {
                count += (condition(row) ? 1 : 0)
            })
            // count += condition(data[data.length - 1]) ? 1 : 0

            return count
        }
    </script>

    <!--  -->
    <!--  -->
    <!-- Exercises Defined as function, and will be called inside a async FunctionIFF -->
    <script>




    </script>

    <script>
        // write your d3 code here.. 
        console.log('d3.version:', d3.version);

        // ------------------------ Exercise 1 ------------------------
        // Answer: Version = 7.3.0

    </script>
    <!-- ------------------------ Exercise 3 ------------------------ -->
    <script>
        (async () => {

            // ------------------------------------------ Exercise 2 ------------------------------------------
            const exercise2 = () => {
                d3
                    .select("p")
                    .style("color", "red")
                    .style("font-size", "32px")
                    .style("line-height", "20px")
                    .text("The paragraph below is a liar")
                    .style('font-family', "cursive")
            }

            // ------------------------------------------ Exercise 3 ------------------------------------------

            const exercise3 = () => {

                const div = addExerciseDiv({ exerciseNumber: 3, flex: true })

                for (let i = 0; i < 10; i++) {

                    div.append('div')
                        .style('width', '30px')
                        .style('height', '30px')
                        .style('margin', '2px')
                        .style('background', () => i > 4 ? 'green' : 'red')
                        .style('text-align', 'center')
                        .text(i + 1)

                }

            }

            // ------------------------------------------ Exercise 4 ------------------------------------------

            const exercise4 = () => {

                const div = addExerciseDiv({ exerciseNumber: 4, flex: true })

                for (let i = 0; i < 10; i++) {

                    div
                        .append('div')
                        .style('width', '30px')
                        .style('height', '30px')
                        .style('margin', '2px')
                        .style('background', () => i > 4 ? 'green' : 'red')
                        .style('text-align', 'center')
                        .attr('id', `exercise4-div-${i}`)
                        .text(i + 1)

                }

                d3
                    .select('#exercise4-div-0')
                    .style('background', 'purple')
                    .text('start')

                d3
                    .select('#exercise4-div-1')
                    .style('width', '70px')
                d3
                    .select('#exercise4-div-2')
                    .style('border-radius', '50px')
                d3
                    .select('#exercise4-div-3')
                    .style('border', '2px solid black')

            }

            // ------------------------------------------ Exercise 5 ------------------------------------------

            const exercise5 = () => {

                const div = addExerciseDiv({ exerciseNumber: 5 })

                div
                    .text("Hello World!")
                    .style('color', 'green')
                    .style('font-weight', 'bold');

            }

            // ------------------------------------------ Exercise 6 ------------------------------------------

            const exercise6 = () => {

                let otherdata = [{ name: 'test', val: 1 },
                { name: 'other', val: 2 },
                { name: 'b', val: 3 },
                { name: 'color', val: 4 }];

                const div = addExerciseDiv({ exerciseNumber: 6 })

                for (let i = 0; i < otherdata.length; i++) {
                    div
                        .append('div')
                }

                div
                    .selectAll("div")
                    .data(otherdata)
                    .text(function (d, i) {
                        console.log("d.name: " + d.name);
                        console.log("d.val: " + d.val);
                        console.log("i: " + i);
                        console.log("this: " + this);
                        return 'cont:' + d.name; // return value is used to set the 'text'
                    });


            }
            // ------------------------------------------ Exercise 7 ------------------------------------------

            const exercise7 = () => {


                let num = [10, 50, 100, 200];

                const div = addExerciseDiv({ exerciseNumber: 7 })

                // Adding 4 divs
                for (let i = 0; i < num.length; i++) {
                    div
                        .append('div')
                }

                div
                    .selectAll("div")
                    .data(num)
                    .text(function (d, i) {
                        return 'cont:' + d; // return value is used to set the 'text'
                    })
                    .style("color", function (d, i) {
                        if (d > 49 && d < 101) {
                            return "red";
                        } else {
                            return "yellow";
                        }
                        return 'blue';
                    });


            }

            // ------------------------------------------ Exercise 8 ------------------------------------------

            const exercise8 = () => {

                const div = addExerciseDiv({ exerciseNumber: 8 })

                var data = ['a', 4, 1, 'b', 6, 2, 8, 9, 'z'];

                // Adds a div with an Id excercise8 
                // Adds span inside #exercise8
                div
                    .selectAll("span")
                    .data(data)
                    .enter()
                    .append('span')
                    .style('color', (d) => typeof (d) == 'number' ? 'green' : 'blue')
                    .style('font-weight', (d) => typeof (d) == 'number' ? 'bold' : 'regular')
                    .text(function (d, i) {
                        return d;
                    });


            }

            // ------------------------------------------ Exercise 9 ------------------------------------------

            const exercise9 = async () => {

                const div = addExerciseDiv({ exerciseNumber: 9, flex: true })

                var data = await getCsv('https://raw.githubusercontent.com/dsindy/kaggle-titanic/master/data/test.csv')

                var countData = {}

                countData['Male'] = getCountFromCSV(data, (row) => row['Sex'] == 'male')
                countData['Female'] = getCountFromCSV(data, (row) => row['Sex'] == 'female')
                countData['Mr'] = getCountFromCSV(data, (row) => row['Name'].match('Mr.') != null)
                countData['Mrs'] = getCountFromCSV(data, (row) => row['Name'].match('Mrs.') != null)

                let valueDivs = div
                    .selectAll('div')
                    .data(Object.entries(countData))
                    .enter()
                    .append('div')
                    .style('text-align', 'center')
                    .style('margin', '10px')

                valueDivs
                    .append('h4')
                    .text((d) => d[0])

                valueDivs
                    .append('p')
                    .text((d) => d[1])
            }

            const exercise10 = async () => {
                /*
                age,anaemia,creatinine_phosphokinase,diabetes,ejection_fraction,high_blood_pressure,platelets,serum_creatini
                ne,serum_sodium,sex,smoking,time,DEATH_EVENT
                75,0,582,0,20,1,265000,1.9,130,1,0,4,1
                55,0,7861,0,38,0,263358.03,1.1,136,1,0,6,1
                65,0,146,0,20,0,162000,1.3,129,1,1,7,1
                50,1,111,0,20,0,210000,1.9,137,1,0,7,1
                */
                let countData = {
                    '1-30': 0,
                    '31-40': 0,
                    '41-60': 0,
                    '61-100': 0,
                }

                d3.csv(heartfailurecsv, function (data) {
                    //console.log( data.age);
                    // todo
                    if (data.age < 31) {
                        countData['1-30']++
                    }
                    else if (data.age < 41) {
                        countData['31-40']++
                    }
                    else if (data.age < 61) {
                        countData['41-60']++
                    }
                    else if (data.age < 101) {
                        countData['61-100']++
                    }
                }).then(() => {

                    const mainDiv = addExerciseDiv({ exerciseNumber: 10, flex: true })

                    const divs = mainDiv
                        .selectAll('div')
                        .data(Object.entries(countData))
                        .enter()
                        .append('div')
                        .style('text-align', 'center')
                        .style('margin', '10px')

                    divs
                        .append('h4')
                        .text(d => d[0])
                    divs
                        .append('p')
                        .text(d => d[1])

                })

            }

            const exercise11 = () => {

                const mainDiv = addExerciseDiv({ exerciseNumber: 11 })

                var svg = mainDiv
                    .append("svg")
                    .attr("width", 400)
                    .attr("height", 400)
                    .style("border", '1px solid green');

                //Create line element inside SVG
                svg.append("line")
                    .attr("x1", 95)
                    .attr("x2", 205)
                    .attr("y1", 95)
                    .attr("y2", 95)
                    .attr("stroke", "blue")
                    .attr("stroke-width", '10px')

                svg.append("line")
                    .attr("x1", 200)
                    .attr("x2", 200)
                    .attr("y1", 100)
                    .attr("y2", 200)
                    .attr("stroke", "pink")
                    .attr("stroke-width", '10px')

                svg.append("line")
                    .attr("x1", 205)
                    .attr("x2", 95)
                    .attr("y1", 205)
                    .attr("y2", 205)
                    .attr("stroke", "purple")
                    .attr("stroke-width", '10px')

                svg.append("line")
                    .attr("x1", 100)
                    .attr("x2", 100)
                    .attr("y1", 200)
                    .attr("y2", 100)
                    .attr("stroke", "orange")
                    .attr("stroke-width", '10px')

            }

            const exercise14 = () => {

                let countData = {
                    '1-30': 0,
                    '31-40': 0,
                    '41-60': 0,
                    '61-100': 0,
                }

                d3.csv(heartfailurecsv, function (data) {
                    //console.log( data.age);
                    // todo
                    if (data.age < 31) {
                        countData['1-30']++
                    }
                    else if (data.age < 41) {
                        countData['31-40']++
                    }
                    else if (data.age < 61) {
                        countData['41-60']++
                    }
                    else if (data.age < 101) {
                        countData['61-100']++
                    }
                }).then(() => {


                    const mainDiv = addExerciseDiv({ exerciseNumber: 14 })
                    // Updating the text of h3
                    d3.select('#exercise14').select('h3').text('Exercise 14 & 15')

                    var data = Object.entries(countData);
                    // console.log("Data")
                    // console.log(data)

                    var width = 500;
                    var scaleFactor = 2;
                    var barHeight = 20;

                    var graph = mainDiv
                        .append("svg")
                        .attr("width", width)
                        .attr("height", barHeight * data.length);

                    var bar = graph.selectAll("g")
                        .data(data)
                        .enter()
                        .append("g")
                        .attr("transform", function (d, i) {
                            return "translate(0," + i * barHeight + ")";
                        });

                    bar.append("rect")
                        .attr("width", function (d) {
                            return d[1] * scaleFactor;
                        })
                        .attr("height", barHeight - 1)
                        .attr("x", 100)
                        .style('fill', (d) => d[1] > 100 ? "red" : "blue");

                    // Title
                    bar.append("text")
                        .attr("x", 50)
                        .attr("y", barHeight / 2)
                        .attr("dy", ".35em")
                        .style('fill', 'black')
                        .style('font-size', '16px')
                        .text((d) => d[0]);
                    // Amount
                    bar.append("text")
                        .attr("x", function (d) { return (d[1] * scaleFactor) + 100; })
                        .attr("y", barHeight / 2)
                        .attr("dy", ".35em")
                        .style('fill', 'black')
                        .style('font-size', '16px')
                        .text((d) => d[1]);


                })
            }

            const exercise16 = async () => {
                const width = 600;
                const height = 200;
                const data = [10, 15, 20, 25, 30];
                // Note different valid ways of specifying color
                const colors = ['#ffffcc', 'red', 'rgb(0,255,0)', '#31a354', '#006837'];

                const mainDiv = addExerciseDiv({ exerciseNumber: 16 })
                d3.select('#exercise16').append('h4').text('Odd Number = Square, Even Number = Circle')

                const svg = mainDiv
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height);
                const g = svg.selectAll("g")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("transform", function (d, i) {
                        return "translate(0,0)";
                    })

                // console.log("Gada")
                // console.log(g)

                // if even then draw circle
                g.each(((d, i) => {
                    // console.log(d)

                    if (d % 2 == 0) {
                        // console.log(true)
                        g.append("circle")
                            .attr("cx", function () {
                                return i * 100 + 50 + (d * 1.5);
                            })
                            .attr("cy", function () {
                                return 100;
                            })
                            .attr("r", function () {
                                return d * 1.5;
                            })
                            .attr("fill", function () {
                                return colors[i];
                            })
                        return
                    } else {
                        // console.log(false)
                        g.append("rect")
                            .attr("x", function () {
                                return i * 100 + 50;
                            })
                            .attr("y", function () {
                                return 100 - (d * 0.7);
                            })
                            .attr("width", function () {
                                return d * 1.5;
                            })
                            .attr("height", function () {
                                return d * 1.5;
                            })
                            .attr("fill", function () {
                                return colors[i];
                            });
                    }
                }))
                g.append("text")
                    .attr("x", function (d, i) {
                        return i * 100 + 40;
                    })
                    .attr("y", 105)
                    .attr("stroke", "teal")
                    .attr("font-size", "12px")
                    .attr("font-family", "sans-serif")
                    .text(function (d) {
                        return d;
                    });

            }

            const exercise17 = () => {
                const data = [50, 400, 300, 900, 250, 1000]
                const width = 500;
                const barHeight = 20;
                const margin = 1;

                const mainDiv = addExerciseDiv({ exerciseNumber: 17 })

                var scale = d3.scaleLinear()
                    .domain([d3.min(data), d3.max(data)])
                    .range([50, 500]);
                var svg = mainDiv
                    .append("svg")
                    .attr("width", width)
                    .attr("height", barHeight * data.length);
                var g = svg.selectAll("g")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("transform", function (d, i) {
                        return "translate(0," + i * barHeight + ")";
                    });
                g.append("rect")
                    .attr("width", function (d) {
                        return scale(d);
                    })
                    .style('fill', (d) => {
                        // console.log(d)
                        if (d < 100) {
                            return 'green'
                        } else if (d > 500) {
                            return 'red'
                        }

                        return 'blue'

                    })
                    .attr("height", barHeight - margin)
                g.append("text")
                    .attr("x", function (d) { return (scale(d)); })
                    .attr("y", barHeight / 2)
                    .attr("dy", ".35em")
                    .style('text-anchor', 'end')
                    .text(function (d) { return d; });
            }




            exercise2()
            exercise3()
            exercise4()
            exercise5()
            exercise6()
            exercise7()
            exercise8()
            exercise9()
            exercise10()
            exercise11()
            exercise14()
            exercise16()
            exercise17()

        })()

    </script>

    <!-- ------------------------ Exercise 14 and 15 ------------------------ -->
    <style>
        svg rect {
            fill: blue;
        }

        svg text {
            fill: white;
            font: 10px sans-serif;
            text-anchor: end;
        }
    </style>


    <script>

    </script>
    <!-- ------------------------ Exercise 17 ------------------------ -->

    <div id='exercise18'></div>
    <script>
            (async () => {
                let data = await getCsv('https://raw.githubusercontent.com/dsindy/kaggle-titanic/master/data/test.csv')
                // console.log(data)
                const width = 500;
                const barHeight = 20;
                const margin = 1;
                var scale = d3.scaleLinear()
                    .domain([d3.min(data), d3.max(data)])
                    .range([50, 500]);
                var svg = d3.select("#exercise17")
                    .append("svg")
                    .attr("width", width)
                    .attr("height", barHeight * data.length);
                var g = svg.selectAll("g")
                    .data(data)
                    .enter()
                    .append("g")
                    .attr("transform", function (d, i) {
                        return "translate(0," + i * barHeight + ")";
                    });
                g.append("rect")
                    .attr("width", function (d) {
                        return scale(d);
                    })
                    .style('fill', (d) => {
                        // console.log(d)
                        if (d < 100) {
                            return 'green'
                        } else if (d > 500) {
                            return 'red'
                        }

                        return 'blue'

                    })
                    .attr("height", barHeight - margin)
                g.append("text")
                    .attr("x", function (d) { return (scale(d)); })
                    .attr("y", barHeight / 2)
                    .attr("dy", ".35em")
                    .style('text-anchor', 'end')
                    .text(function (d) { return d; });
            })()
    </script>

</body>

</html>