<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab2 - DV - mu15</title>
    <script src='https://d3js.org/d3.v7.min.js'></script>
</head>



<!-- Only keyframes -->


<body>
    <style>
        .center {
            display: flex;
            justify-content: center;
            align-items: center;
        }
    </style>
    <div id='exercise1'></div>
    <div id='exercise2'></div>
    <div id='exercise3'></div>
    <div id='exercise4'></div>
    <div id='exercise5'></div>
    <div id='exercise6'></div>
    <div id='exercise7'></div>
    <div id='exercise8'></div>
    <div id='exercise9'></div>
    <div id='exercise10'></div>
    <div id='exercise11'></div>
    <div id='exercise12'></div>
    <div id='exercise13'></div>
    <div id='exercise14'></div>
    <div id='exercise15'></div>
    <div id='exercise16'></div>
    <div id='exercise17'></div>
    <div id='exercise18'></div>
    <div id='exercise19'></div>
    <div id='exercise20'></div>
    <div id='exercise21'></div>
    <div id='exercise22'></div>
    <div id='exercise23'></div>
    <div id='exercise24'></div>
    <div id='exercise25'></div>
    <div id='exercise26'></div>
    <div id='exercise27'></div>
    <div id='exercise28'></div>
    <div id='exercise29'></div>
    <div id='exercise30'></div>
    <div id='exercise31'></div>
    <div id='exercise32'></div>

    <!-- Reusable Functions -->
    <script>
        const addExerciseDiv = ({ exerciseNumber, flex = false }) => {
            let div = d3
                .select(`#exercise${exerciseNumber}`)

            div
                .append('h3')
                .text(`Exercise ${exerciseNumber}`)
            // The new div
            const exerciseDiv = div.append('div').style('display', flex ? 'flex' : 'block')
            return exerciseDiv
        }

        // Gets the data from Csv
        // And formats into an array from readable stream
        const getCsv = async (csvUrl) => {
            let data = []
            await d3.csv(csvUrl, (d) => {
                data.push(d);
            })
            return data
        }

        // Gets count from csv with a specific condition
        const getCountFromCSV = (data, condition) => {
            let count = 0;
            data.forEach((row) => {
                count += (condition(row) ? 1 : 0)
            })

            return count
        }

        // Get all the values of a key from the data
        // Has an extra callback function for parsing the data 
        // For example, parseInt
        const getArrayFromCsv = (csvData, key, parseDataFunc = (d) => { return d }) => {

            let data = []
            csvData.forEach((d) => {

                data.push(parseDataFunc(d[key]))
            })

            return data
        }

        // Plots graph
        const plotGraph = ({ xSize = 600,
            ySize = 600,
            margin = 40,
            data,
            parent,
            svg = null,
            color = null,
        }) => {

            const xMax = xSize - margin * 2;
            const yMax = ySize - margin * 2;
            // Get the 'limits' of the data - the full extent (mins and max)
            // so the plotted data fits perfectly 
            const xExtent = d3.extent(data, d => { return d.x });
            const yExtent = d3.extent(data, d => { return d.y });
            // Append SVG Object to the Page
            if (svg == null) {
                svg = parent
                    .append("svg")
                    .attr('width', xSize)
                    .attr('height', ySize)
                    .append("g")
                    .attr("transform", `translate(${margin}, ${margin})`);
            }
            // X Axis
            const x = d3.scaleLinear()
                .domain([xExtent[0], xExtent[1]])
                .range([0, xMax]);
            // bottom
            svg.append("g")
                .attr("transform", `translate(0, ${yMax})`)
                .call(d3.axisBottom(x))
                .attr('color', 'green'); // make bottom axis green
            // top
            svg.append("g")
                .call(d3.axisTop(x));
            // Y Axis
            const y = d3.scaleLinear()
                .domain([yExtent[0], yExtent[1]])
                .range([yMax, 0]);
            // left y axis
            svg.append("g")
                .call(d3.axisLeft(y));
            // right y axis
            svg.append("g")
                .attr("transform", `translate(${yMax},0)`)
                .call(d3.axisRight(y));
            // Add the line
            if (color != null) {

                let id = (Math.random() + 1).toString(36).substring(2);
                svg.append("linearGradient")
                    .attr('id', id)
                    .attr("gradientUnits", "userSpaceOnUse")
                    // .attr("gradientTransform", "rotate(90)")
                    .attr("x1", 0)
                    .attr("x2", 0)
                    .attr("y1", y(0))
                    .attr("y2", ySize)
                    .selectAll("stop")
                    .data([...Array(100).keys()])
                    .enter()
                    .append("stop")
                    .attr("offset", d => d + '%')
                    .attr("stop-color", d => color(d));

                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", `url(#${id})`)
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function (d) { return x(d.x) })
                        .y(function (d) { return y(d.y) })
                    );
            } else {
                svg.append("path")
                    .datum(data)
                    .attr("fill", "none")
                    .attr("stroke", "steelblue")
                    .attr("stroke-width", 1.5)
                    .attr("d", d3.line()
                        .x(function (d) { return x(d.x) })
                        .y(function (d) { return y(d.y) })
                    );
            }

            return [svg, x, y];
        }
    </script>

    <!-- Exercise Function -->
    <script>
        (async () => {
            const exercise1 = () => {
                const div = addExerciseDiv({ exerciseNumber: 1 });

                // Generate Data
                const numPoints = 100;
                const dataCos = [];
                for (let i = 0; i < numPoints; i++) { dataCos.push({ x: i / 100, y: Math.cos(6.2 * i / 100) }); }

                // Assign size for the graph
                const xSize = 600;
                const ySize = 600;
                const margin = 30;
                const [svg, xScaled, yScaled] = plotGraph({ data: dataCos, parent: div })

                // Add dots to the svg and position them according to the data
                // Add some transition to the dots, to have pulse effect
                svg.selectAll("dot")
                    .data(dataCos)
                    .enter()
                    .append('path')
                    .attr('d', d3.symbol().size(20))
                    .attr('transform', (d) => `translate(${xScaled(d.x)}, ${yScaled(d.y)})`)
                    .style('fill', 'red')
                    .on('mouseover', function (e) {

                        // transition that creates pulse effect on the dotes
                        const pulse = () => {
                            d3.select(this)
                                .style('stroke', 'purple')
                                .transition().duration(200)
                                .attr('transform', (d) => `translate(${xScaled(d.x)}, ${yScaled(d.y)}) scale(1.3, 1.3)`)
                                .transition().duration(200)
                                .attr('transform', (d) => `translate(${xScaled(d.x)}, ${yScaled(d.y)}) scale(1, 1)`)
                                .on('end', pulse)
                        }
                        pulse()

                    })
                    .on('mouseout', function (e) {
                        d3.select(this)
                            .style('stroke', null)
                            .attr('transform', (d) => `translate(${xScaled(d.x)}, ${yScaled(d.y)}) scale(1, 1)`)
                            .transition()
                    })

            }

            const exercise2 = () => {
                const div = addExerciseDiv({ exerciseNumber: 2, flex: 3 })

                // Set the height and width of the div
                const svg = div
                    .append('svg')
                    .style('width', 200)
                    .style('height', 200)

                // Create a tooltip which would displayed when hovering over an svg element
                // Set the display to block only when the hovering over an svg element
                const tooltip = div
                    .append('div')
                    .attr('id', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,255,0, 0.6)')
                    .style('padding', '8px')
                    .style('border-radius', '10px')
                    .style('display', 'none')
                    .text('Hello')

                // Create a circle with tooltip to be shown when hover 
                // The tooltip will display the radius of the circle
                const circle1 = svg.append('circle')
                    .attr('cx', 75)
                    .attr('cy', 75)
                    .attr('r', 50)
                    .style('fill', 'blue')
                    .style('opacity', 0.6)
                    .on('mouseover', function (d) {
                        console.log(this.pageY)
                        tooltip
                            .style('display', 'block')
                            .style('transform', `translate(125px, 25px)`)
                            .text('Radius: 75px')

                    })
                    .on('mouseout', function (d) {
                        tooltip.style('display', 'none')
                    })


                // Create a circle with tooltip to be shown when hover 
                // The tooltip will display the radius of the circle
                const circle2 = svg.append('circle')
                    .attr('cx', 150)
                    .attr('cy', 150)
                    .attr('r', 25)
                    .style('fill', 'red')
                    .style('opacity', 0.6)
                    .on('mouseover', function (d) {
                        console.log(this.pageY)
                        tooltip
                            .style('display', 'block')
                            .style('transform', `translate(175px, 125px)`)
                            .text('Radius: 25px')

                    })
                    .on('mouseout', function (d) {
                        tooltip.style('display', 'none')
                    })


            }


            const exercise3 = () => {

                const div = addExerciseDiv({ exerciseNumber: 3 })

                // Set the height and width of the div
                div
                    .style("width", "200")
                    .style("height", "200")

                div
                    .append('div')
                    .style('width', '100px')
                    .style('height', '20px')
                    .style('background-color', 'green')
                    .style("transform", "rotate(0deg)")

                // Apply transitions of rotation and color change when hover
                div.selectAll("div")
                    .on("mouseover", function (event) {
                        // Increase the height
                        // And rotate
                        // In a transition
                        d3
                            .select(this)
                            .transition()
                            .duration(500)
                            .style("background-color", "orange")
                            .style("opacity", 0.6)
                            .style("width", '100px')
                            .style("height", '100px')
                            .style("border-radius", '50px')
                            .style("border", '1px dashed black')
                            .style("transform", "rotate(180deg)")
                    })
                    .on("mouseout", function () {
                        // Goes back to initial state
                        d3.select(this)
                            .transition()
                            .duration(500)
                            .style('width', '100px')
                            .style('height', '20px')
                            .style('background-color', 'steelblue')
                            .style("transform", "rotate(0deg)")
                    });
            }

            const exercise4 = () => {
                const div = addExerciseDiv({ exerciseNumber: 4 })

                // Set the height and width of the div
                const svg = div
                    .append('svg')
                    .style('width', 200)
                    .style('height', 200)

                // The radius of the circle increases when hover
                const circle = svg.append('circle')
                    .attr('cx', 100)
                    .attr('cy', 100)
                    .attr('r', 50)
                    .style('fill', 'blue')
                    .style('opacity', 0.6)
                    .on('mouseover', function (d) {
                        circle
                            .transition()
                            .duration(500)
                            .attr('r', 100)


                    })
                    .on('mouseout', function (d) {
                        circle
                            .transition()
                            .duration(500)
                            .attr('r', 50)
                    })
            }

            const exercise5 = () => {
                const div = addExerciseDiv({ exerciseNumber: 5, })

                // Create a tooltip to be shown when hovering over a svg element
                const tooltip = div
                    .append('div')
                    .attr('id', 'tooltip')
                    .style('position', 'absolute')
                    .style('background', 'rgba(0,255,0, 0.6)')
                    .style('padding', '8px')
                    .style('border-radius', '10px')
                    .style('display', 'none')
                    .text('Radius: 75px')

                // Set the height and width of the div
                const svg = div
                    .append('svg')
                    .style('width', 200)
                    .style('height', 200)


                const circle = svg.append('circle')
                    .attr('cx', 75)
                    .attr('cy', 75)
                    .attr('r', 50)
                    .style('fill', 'blue')
                    .style('opacity', 0.6)

                circle
                    .on('mouseover', function (d) {
                        // When hover, turn the tooltip display to block
                        tooltip
                            .style('display', 'block')

                    })
                    .on('mousemove', function (d) {
                        // Position the tooltip acccording to the mouse position
                        // The tooltip sticks with the mouse 
                        const [x, y] = d3.pointer(d, circle.node())
                        tooltip
                            .style('transform', `translate(${x + 10}px, ${y - 25}px)`)
                    })
                    .on('mouseout', function (d) {
                        // When not hover, display = none
                        tooltip
                            .style('display', 'none')
                    })

            }

            const exercise6 = () => {
                const div = addExerciseDiv({ exerciseNumber: 6 })

                // Set the name of the exercise header
                d3
                    .select('#exercise6')
                    .select('h3')
                    .text('Exercise 6,7 & 8')

                // Set the height and width of the div
                div
                    .append("div")
                    .style('width', '200px')
                    .style('height', '200px')
                    .style('background-color', 'blue')
                    .on("mouseover", function (d) {
                        // in the first transition (1000ms)
                        // Reduce the width and height to 150 px
                        // and color to red

                        // In the second transition (1000ms)
                        // Increase the widht and hegiht to 250 px
                        // color to green
                        d3.select(this)
                            .transition()
                            .duration(1000)
                            .style("width", '150px')
                            .style("height", '150px')
                            .style("background-color", "red")
                            .transition()
                            .duration(1000)
                            .style("width", '250px')
                            .style("height", '250px')
                            .style("background-color", "green");

                    })
                    .on("mouseout", function (d) {
                        // return to the initial state
                        d3.select(this)
                            .transition()
                            .duration(1000)
                            .style('width', "200px")
                            .style('height', "200px")
                            .style('background-color', "blue")
                    })
            }

            const exercise9 = () => {
                const div = addExerciseDiv({ exerciseNumber: 9 })

                // div1 with EaseCubic 
                const div1 = div
                    .append("div")
                    .style('width', '100px')
                    .style('height', '100px')
                    .style('background-color', 'blue')
                    .style('transform', 'scale(1.0)')
                    .style('margin', '10px')
                    .attr('class', 'center')
                div1
                    .append('p')
                    .text("Ease Cubic")

                // div2 with EaseElastic 
                const div2 = div
                    .append("div")
                    .style('width', '100px')
                    .style('height', '100px')
                    .style('background-color', 'blue')
                    .style('transform', 'scale(1.0)')
                    .style('margin', '10px')
                    .attr('class', 'center')
                div2
                    .append('p')
                    .text("Ease Elastic")

                // Add another div with a text click me
                // When clicked, it plays the same animation for both div, with different ease function
                div
                    .append("div")
                    .attr('class', 'center')
                    .style('width', '100px')
                    .style('height', '20px')
                    .style('background-color', 'blue')
                    .style('transform', 'scale(1.0)')
                    .style('margin', '10px')
                    .on('click', function (d) {
                        if (div1.style("transform") == 'scale(1)' || div1.style("transform") == 'scale(1, 1)') {
                            div1
                                .transition()
                                .ease(d3.easeCubic)
                                .duration(1000)
                                .style("background-color", "red")
                                .style('transform', 'scale(0.5)')
                            div2
                                .transition()
                                .ease(d3.easeElastic)
                                .duration(1000)
                                .style("background-color", "red")
                                .style('transform', 'scale(0.5)')
                        } else {
                            div1
                                .transition()
                                .ease(d3.easeCubic)
                                .duration(1000)
                                .style("background-color", "blue")
                                .style('transform', 'scale(1)')
                            div2
                                .transition()
                                .ease(d3.easeElastic)
                                .duration(1000)
                                .style("background-color", "blue")
                                .style('transform', 'scale(1)')

                        }

                    })
                    .append('p')
                    .text('Click me')
            }

            const exercise10 = () => {
                const div = addExerciseDiv({ exerciseNumber: 10 })

                const svg = div
                    .append('svg')
                    .style('width', 200)
                    .style('height', 200)
                // Add circle with ease bounce transition when hover
                const circle = svg.append('circle')
                    .attr('cx', 100)
                    .attr('cy', 100)
                    .attr('r', 50)
                    .style('fill', 'blue')
                    .style('opacity', 0.6)
                    .on('mouseover', function (d) {
                        circle
                            .transition()
                            .ease(d3.easeBounce)
                            .duration(500)
                            .attr('r', 100)


                    })
                    .on('mouseout', function (d) {
                        circle
                            .transition()
                            .ease(d3.easeBounce)
                            .duration(500)
                            .attr('r', 50)
                    })
            }

            const exercise11 = () => {

                const div = addExerciseDiv({ exerciseNumber: 11 })

                const svg = div
                    .append('svg')
                    .style('width', 500)
                    .style('height', 200)

                // Ease bounce transition of size when hover
                const circle = svg.append('text')
                    .text("Hello World")
                    .attr('font-size', '24px')
                    .style('stroke', 'blue')
                    .style("transform", "translate(0px, 100px)")
                    .on('mouseover', function (d) {
                        circle
                            .transition()
                            .ease(d3.easeBounce)
                            .duration(500)
                            .attr('stroke', 'red')
                            .attr('font-size', '48px')


                    })
                    .on('mouseout', function (d) {
                        circle
                            .transition()
                            .ease(d3.easeBounce)
                            .duration(500)
                            .attr('font-size', '24px')
                            .attr('stroke', 'blue')

                    })
            }

            const exercise12 = () => {


                const div = addExerciseDiv({ exerciseNumber: 12 })

                var svg = div
                    .append("svg")
                    .attr("width", 300)
                    .attr("height", 300);
                var bar1 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 100)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar2 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 120)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar3 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 140)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                grow();
                // Grows each bar with a duration of 2000
                // Each bar is delayed untill the last bar is finished in transitioning
                function grow() {
                    bar1.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .attr("height", 100)
                    bar2.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(2000)
                        .attr("height", 100)
                    bar3.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(4000)
                        .attr("height", 100)
                }
            }

            const exercise13 = () => {

                const div = addExerciseDiv({ exerciseNumber: 13 })

                var svg = div
                    .append("svg")
                    .attr("width", 300)
                    .attr("height", 300);
                var bar1 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 100)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar2 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 120)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar3 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 140)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                // Grows each bar with a duration of 2000
                // Each bar is delayed untill the last bar is finished in transitioning
                let grow = () => {
                    bar1.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .attr("height", 100)
                    bar2.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(2000)
                        .attr("height", 100)
                    bar3.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(4000)
                        .attr("height", 100)
                        .on("end", shrink)
                }
                // shrinks each bar with a duration of 2000
                // Each bar is delayed untill the last bar is finished in transitioning
                // When the last bar is finished animating the grow function is called
                let shrink = () => {
                    bar1.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .attr("height", 20)
                    bar2.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(2000)
                        .attr("height", 20)
                    bar3.transition()
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(4000)
                        .attr("height", 20)
                        .on("end", grow)
                    // .call(grow)
                }
                grow();

            }


            const exercise14 = () => {

                const div = addExerciseDiv({ exerciseNumber: 14 })

                var svg = div
                    .append("svg")
                    .attr("width", 300)
                    .attr("height", 300);
                var bar1 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 100)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar2 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 120)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)
                var bar3 = svg.append("rect")
                    .attr("fill", "blue")
                    .attr("x", 140)
                    .attr("y", 20)
                    .attr("height", 20)
                    .attr("width", 10)

                // Grows each bar with a duration of 2000
                // Each bar is delayed untill the last bar is finished in transitioning
                let grow = () => {
                    bar1.transition()
                        .attr("fill", "red")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .attr("height", 100)
                    bar2.transition()
                        .attr("fill", "red")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(2000)
                        .attr("height", 100)
                    bar3.transition()
                        .attr("fill", "red")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(4000)
                        .attr("height", 100)
                        .on("end", shrink)
                }
                // shrinks each bar with a duration of 2000
                // Each bar is delayed untill the last bar is finished in transitioning
                // When the last bar is finished animating the grow function is called
                let shrink = () => {
                    bar1.transition()
                        .attr("fill", "blue")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .attr("height", 20)
                    bar2.transition()
                        .attr("fill", "blue")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(2000)
                        .attr("height", 20)
                    bar3.transition()
                        .attr("fill", "blue")
                        .ease(d3.easeLinear)
                        .duration(2000)
                        .delay(4000)
                        .attr("height", 20)
                        .on("end", grow)
                    // .call(grow)
                }
                grow();

            }

            const exercise15 = () => {

                const div = addExerciseDiv({ exerciseNumber: 15 })
                const csvLink = './csv/15.csv'

                d3
                    .select('#exercise15')
                    .select('h3')
                    .text('Exercise 15, 16 & 17')

                // Sets the hieght and width of the div
                var svg = div
                    .append('svg')
                    .attr("width", 600)
                    .attr("height", 600);

                var margin = 200;
                var width = svg.attr("width") - margin;
                var height = svg.attr("height") - margin;

                // Appends the text Stock price
                svg.append("text")
                    .attr("transform", "translate(100,0)")
                    .attr("x", 50)
                    .attr("y", 50)
                    .attr("font-size", "24px")
                    .text("Stock Price")

                // Creates the X and Y scales
                var x = d3.scaleBand().range([0, width]).padding(0.4);
                var y = d3.scaleLinear().range([height, 0]);
                // Adds a G where the svg elements will be added
                var g = svg.append("g")
                    .attr("transform", "translate(" + 100 + "," + 100 + ")");

                // After Csv file is loaded
                d3.csv(csvLink).then(function (data) {
                    // Get the all values from the "value" field
                    const values = getArrayFromCsv(data, 'value')
                    // Create sequential color by using the min and max of values
                    const myColor = d3.scaleSequential().domain([d3.min(values), d3.max(values)]).interpolator(d3.interpolateViridis);

                    // Set the x and y domain to year and value respectively
                    x.domain(data.map(function (d) { return d.year; }));
                    y.domain([0, d3.max(data, function (d) { return d.value; })]);

                    // Add Axis bottom
                    g.append("g")
                        .attr("transform", "translate(0," + height + ")")
                        .call(d3.axisBottom(x))
                        .append("text")
                        .attr("y", height - 250)
                        .attr("x", width - 100)
                        .attr("text-anchor", "end")
                        .attr("stroke", "black")
                        .text("Year");

                    // Add Axis Left
                    g.append("g")
                        .call(d3.axisLeft(y).tickFormat(function (d) {
                            return "$" + d;
                        }).ticks(10))
                        .append("text")
                        .attr("transform", "rotate(-90)")
                        .attr("y", 6)
                        .attr("dy", "-5.1em")
                        .attr("text-anchor", "end")
                        .attr("stroke", "black")
                        .text("Stock Price");

                    // Add bars for the bar chart
                    // with transition 
                    // When hover the OnMouseOver is called
                    // When not hovering, onMouseOut is called
                    g.selectAll(".bar")
                        .data(data)
                        .enter().append("rect")
                        .attr("class", "bar")
                        // .on(….. ) – call mouse events here…
                        .attr("x", function (d) { return x(d.year); })
                        .attr("y", function (d) { return y(d.value); })
                        .attr("width", x.bandwidth())
                        .style("fill", (d) => myColor(d.value))
                        .on('mouseover', onMouseOver)
                        .on('mouseout', onMouseOut)
                        .transition()
                        .ease(d3.easeLinear)
                        .duration(400)
                        .delay(function (d, i) {
                            return i * 50;
                        })
                        .attr("height", function (d) { return height - y(d.value); })
                });

                // Increases the height of the bar and shows the value of the bar 
                // at the top right of the bar
                function onMouseOver(e, d) {
                    d3.select(this).attr('class', 'highlight');
                    d3.select(this)
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function () { return y(d.value) - 10; })
                        .attr("height", function () { return height - y(d.value) + 10; });

                    g.append("text")
                        .attr('class', 'val')
                        .attr('x', function () {
                            return x(d.year);
                        })
                        .attr('y', function () {
                            return y(d.value) - 15;
                        })
                        .text(function () { return '$' + d.value; }); // Value of the text
                }
                //mouseout event handler function
                function onMouseOut(d, i) {
                    // use the text label class to remove label on mouseout
                    d3.select(this).attr('class', 'bar');
                    d3.select(this)
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth())
                        .attr("y", function (d) { return y(i.value); })
                        .attr("height", function (d) { return height - y(i.value); });
                    d3.selectAll('.val')
                        .remove()
                }


            }

            const exercise18 = () => {

                // create 2 data_set
                const data1 = [
                    { group: "A", value: 5 },
                    { group: "B", value: 20 },
                    { group: "C", value: 9 }
                ];
                const data2 = [
                    { group: "A", value: 10 },
                    { group: "B", value: 2 },
                    { group: "C", value: 22 }
                ];
                const data3 = [
                    { group: "A", value: 19 },
                    { group: "B", value: 13 },
                    { group: "C", value: 2 },
                    { group: "D", value: 10 },
                ];
                // set the dimensions and margins of the graph
                const margin = { top: 30, right: 30, bottom: 70, left: 60 };
                const width = 460 - margin.left - margin.right;
                const height = 400 - margin.top - margin.bottom;

                // Create the exercise div
                const div = addExerciseDiv({ exerciseNumber: 18 })


                d3
                    .select('#exercise18')
                    .select('h3')
                    .text('Exercise 18, 19, 20, 21 & 22')

                // Add buttons to div
                div.append('button')
                    .on('click', () => { update(data1) })
                    .text("Dataset 1")
                div.append('button')
                    .on('click', () => { update(data2, "#5afa23") })
                    .text("Dataset 2")
                div.append('button')
                    .on('click', () => { update(data3, "#a25693") })
                    .text("Dataset 3")

                // append the svg object to the body of the page
                var svg = div
                    .append('div')
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 25])
                    .range([height, 0]);

                // Add Y Left Axis to svg
                svg.append("g")
                    .attr("class", "myYLeftaxis")
                    .call(d3.axisLeft(y));
                // Add Y Right Axis to svg
                svg.append("g")
                    .attr("transform", `translate(${width},0)`)
                    .attr("class", "myYRightaxis")
                    .call(d3.axisRight(y));
                function getX(data) {
                    // X axis
                    var x = d3.scaleBand()
                        .range([0, width])
                        .domain(data.map(function (d) { return d.group; }))
                        .padding(0.2);

                    return x

                }
                // Add bottom axis
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .attr("class", "myXBottomaxis")
                    .call(d3.axisBottom(getX(data1)))
                // Add Top Axis
                svg.append("g")
                    .attr("class", "myXTopaxis")
                    .call(d3.axisTop(getX(data1)));

                // A function that create / update the plot for a given variable:
                const update = (data, fill = "#69b3a2", x) => {
                    var x = getX(data)

                    // Add X axis to svg
                    d3.select('.myXBottomaxis')
                        .transition()
                        .duration(1000)
                        .call(d3.axisBottom(x))
                    d3.select('.myXTopxis')
                        .transition()
                        .duration(1000)
                        .call(d3.axisTop(x))

                    // Add the bars to the svg
                    var u = svg.selectAll("rect")
                        .data(data)
                    u
                        .enter()
                        .append("rect")
                        .on("mouseover", (e, d) => { onMouseOver(e, d, u, getX(data)); })
                        .on("mouseout", (e, d) => { onMouseOut(e, d, u, getX(data)); })
                        .merge(u)
                        .transition()
                        .duration(1000)
                        .attr("x", function (d) { return x(d.group); })
                        .attr("y", function (d) { return y(d.value); })
                        .attr("width", x.bandwidth())
                        .attr("height", function (d) { return height - y(d.value); })
                        .attr("fill", fill)
                    u
                        .exit()
                        .transition()
                        .duration(1000)
                        .attr("fill", `rgba(0, 0, 0, 0)`)

                }

                // Defining functions for mouseover and mouse out
                function onMouseOver(event, d, element, x) {
                    element.attr('class', 'highlight');
                    element
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth() + 5)
                        .attr("y", function () { return y(d.value) - 10; })
                        .attr("height", function () { return height - y(d.value) + 10; });

                    svg.append("text")
                        .attr('class', 'val')
                        .attr('x', function () {
                            return x(d.group);
                        })
                        .attr('y', function () {
                            return y(d.value) - 15;
                        })
                        .text(function () { return '$' + d.value; }); // Value of the text
                }
                //mouseout event handler function
                function onMouseOut(event, d, element, x) {
                    // use the text label class to remove label on mouseout
                    element.attr('class', 'bar');
                    element
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth())
                        .attr("y", function () { return y(d.value); })
                        .attr("height", function () { return height - y(d.value); });
                    d3.selectAll('.val')
                        .remove()
                }

                // Initialize the plot with the first dataset
                update(data1)
                // update(data1)

            }

            const exercise23 = () => {

                // create 2 data_set
                const data1 = [
                    { group: "A", value: 5 },
                    { group: "B", value: 20 },
                    { group: "C", value: 9 }
                ];
                const data2 = [
                    { group: "A", value: 10 },
                    { group: "B", value: 2 },
                    { group: "C", value: 22 }
                ];
                const data3 = [
                    { group: "A", value: 19 },
                    { group: "B", value: 13 },
                    { group: "C", value: 2 },
                    { group: "D", value: 10 },
                ];
                // set the dimensions and margins of the graph
                const margin = { top: 30, right: 30, bottom: 70, left: 60 };
                const width = 460 - margin.left - margin.right;
                const height = 400 - margin.top - margin.bottom;

                // Create the exercise div
                const div = addExerciseDiv({ exerciseNumber: 23 })

                // Add buttons to div
                div.append('button')
                    .on('click', () => { update(data1) })
                    .text("Dataset 1")
                div.append('button')
                    .on('click', () => { update(data2, "#5afa23") })
                    .text("Dataset 2")
                div.append('button')
                    .on('click', () => { update(data3, "#a25693") })
                    .text("Dataset 3")

                // append the svg object to the body of the page
                var svg = div
                    .append('div')
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                        "translate(" + margin.left + "," + margin.top + ")");

                // Add Y axis
                var y = d3.scaleLinear()
                    .domain([0, 25])
                    .range([height, 0]);

                // Add Y Left Axis to svg
                svg.append("g")
                    .attr("class", "myYLeftaxis")
                    .call(d3.axisLeft(y));
                // Add Y Right Axis to svg
                svg.append("g")
                    .attr("transform", `translate(${width},0)`)
                    .attr("class", "myYRightaxis")
                    .call(d3.axisRight(y));

                function getX(data, padding = 0.2) {
                    // X axis
                    var x = d3.scaleBand()
                        .range([0, width])
                        .domain(data.map(function (d) { return d.group; }))
                        .padding(padding);

                    return x

                }
                // Add Bottom X axis
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .attr("id", "myXBottomaxis")
                    .call(d3.axisBottom(getX(data1)))
                // Add Top X axis
                svg.append("g")
                    .attr("id", "myXTopaxis")
                    .call(d3.axisTop(getX(data1)));

                // A function that create / update the plot for a given variable:
                function update(data, fill = "#69b3a2", x) {
                    var x = getX(data, 1)
                    // Add X axis to svg
                    d3.select('#myXBottomaxis')
                        .transition()
                        .duration(1000)
                        .call(d3.axisBottom(x))
                    d3.select('#myXTopaxis')
                        .transition()
                        .duration(1000)
                        .call(d3.axisTop(x))

                    // Add circles to points of the data
                    var circle = svg.selectAll("circle")
                        .data(data)

                    circle
                        .enter()
                        .append("circle")
                        .on("mouseover", (e, d) => { onMouseOver(e, d, circle, x); })
                        .on("mouseout", (e, d) => { onMouseOut(e, d, circle, x); })
                        .merge(circle)
                        .transition()
                        .duration(1000)
                        .attr("cx", function (d) { return x(d.group); })
                        .attr("cy", function (d) { return y(d.value); })
                        .attr("r", 5)
                        .attr("fill", fill)
                    circle
                        .exit()
                        .transition()
                        .duration(1000)
                        .attr("fill", `rgba(0, 0, 0, 0)`)
                        .remove()

                    var g = svg.append('g')

                    var lines = svg
                        .selectAll('.graph-line')
                        .data(data.slice(0, -1))

                    lines
                        .enter()
                        .append("line")
                        .attr("class", "graph-line")
                        .merge(lines)
                        .transition()
                        .duration(1000)
                        .attr("x1", (d, i) => x(d.group))
                        .attr("x2", (d, i) => x(data[i + 1].group))
                        .attr("y1", (d, i) => y(d.value))
                        .attr("y2", (d, i) => y(data[i + 1].value))
                        .attr("stroke", "#f15fa3")
                        .attr("stroke-width", 2)

                    lines
                        .exit()
                        .transition()
                        .duration(1000)
                        .attr("stroke", `rgba(0, 0, 0, 0)`)
                        .remove()
                }

                // Defining functions for mouseover and mouse out
                function onMouseOver(event, d, element, x) {
                    element.attr('class', 'highlight');
                    element
                        .transition() // adds animation
                        .duration(400)
                        // .attr("y", function () { return y(d.value) - 10; })
                        .attr("r", function () { return height - y(d.value) + 10; });

                    svg.append("text")
                        .attr('class', 'val')
                        .attr('x', function () {
                            return x(d.group);
                        })
                        .attr('y', function () {
                            return y(d.value) - 15;
                        })
                        .text(function () { return '$' + d.value; }); // Value of the text
                }
                //mouseout event handler function
                function onMouseOut(event, d, element, x) {
                    // use the text label class to remove label on mouseout
                    element.attr('class', 'bar');
                    element
                        .transition() // adds animation
                        .duration(400)
                        .attr('width', x.bandwidth())
                        .attr("y", function () { return y(d.value); })
                        .attr("height", function () { return height - y(d.value); });
                    d3.selectAll('.val')
                        .remove()
                }

                // Initialize the plot with the first dataset
                update(data1)
                // update(data1)

            }

            const exercise24 = () => {
                let intr = d3.interpolate([20, 40, 4], [1, 12, 10])
                console.log("Exercise 24")
                console.log("Type of returned function is: ", typeof (intr));
                console.log(intr(0.2))
                // For the first case, the answer would be
                // 20 - 1 = 19
                // 20 - (19 * 0.2)
                // 16.8
            }

            const exercise25 = () => {
                console.log("Exercise 25")
                let cc = d3.interpolate('red', 'green')
                // in 0.5
                // R in rgb interpolates from 255 to 128
                // g in rgb interpolates from 0 to 64
                console.log(cc(0.5));
            }
            const exercise26 = () => {
                console.log("Exercise 26")
                // 2/7/2000
                let birthDate = new Date(2000, 6, 2)
                let dateNow = Date.now()
                let inter = d3.interpolateDate(birthDate, dateNow)
                console.log(inter(0.5));
            }

            const exercise27 = () => {
                const div = addExerciseDiv({ exerciseNumber: 27 })
                var dataset = {
                    apples: [5345, 2879, 1997, 2437, 4045],
                    banana: [45, 209, 327, 156, 284, 400, 95],
                };

                // Add buttons to div
                const buttonDiv = div.append('div')
                buttonDiv.append('button')
                    .on('click', () => { update(dataset.apples) })
                    .text("Dataset Apples")
                buttonDiv.append('button')
                    .on('click', () => { update(dataset.banana) })
                    .text("Dataset Bananas")

                // Set the width and height
                var width = 460,
                    height = 300,
                    radius = Math.min(width, height) / 2;
                // Create a color scheme
                var color = d3.scaleOrdinal().range(d3.schemeSet3);

                var pie = d3.pie()
                    .sort(null);

                var arc = d3.arc()
                    .innerRadius(radius - 100)
                    .outerRadius(radius - 50);

                // Add an svg
                var svg = div
                    .append("svg")
                    .attr("width", width)
                    .attr("height", height)
                    .append("g")
                    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

                function update(data) {

                    // Add another G with class pie-chart
                    // Then add the path to create the pie chart
                    // Add a smooth transition 
                    var path = svg
                        .selectAll(".pie-chart")
                        .append('g')
                        .attr("class", 'pie-chart')
                        .data((d) => {
                            return pie(data)
                        })
                        .enter()
                        .append("path")
                        .transition()
                        .ease(d3.easeLinear)
                        .duration((d) => {
                            return ((d.endAngle - d.startAngle) / Math.PI) * 1000
                        })
                        .delay((d) => {
                            return ((d.startAngle / Math.PI) * 1000)
                        })
                        .attr('d', arc)
                        .attr("fill", function (d, i) { return color(i); })
                        .attrTween("d", function (d, i, n) {
                            console.log("arctween")
                            console.log(d.startAngle)
                            console.log(d.endAngle)
                            var i = d3.interpolate(d.startAngle, d.endAngle);
                            return function (t) {
                                d.endAngle = i(t);
                                return arc(d);
                            }
                        })

                    // Remove the first piechart if there are more than one
                    if (svg.selectAll('.pie-chart').size() > 1) {
                        svg.select('.pie-chart').remove()
                    }
                }
                update(dataset.apples)
            }

            const exercise28 = async () => {
                var width = 800, height = 800;
                const div = addExerciseDiv({ exerciseNumber: 28 })

                d3
                    .select('#exercise28')
                    .select('h3')
                    .text('Exercise 28 - 32')

                // setup svg
                div.append('svg').attr('width', width).attr('height', height);

                var color = d3.scaleOrdinal().range(d3.schemeSet3);

                // Get the nodes from csv
                var nodes = await getCsv('./csv/29.csv')
                // Get xCenter from the node radius
                nodes.map((node) => {
                    node.xCenter = (Math.floor(node.radius / 5) + 1) * 100
                })

                // Create simulation
                var simulation = d3.forceSimulation(nodes)
                    .force('charge', d3.forceManyBody().strength(20))
                    .force('x', d3.forceX().x((d) => d.xCenter))
                    .force('y', d3.forceY().y(200))
                    .force('collision', d3.forceCollide().radius(function (d) {
                        return d.radius
                    }))
                    .on('tick', ticked);

                // Create text
                const text = div.select('svg').append('text').text('')

                function ticked() {
                    // Add the circle with nodes as the data
                    var circle = div.select('svg')
                        .selectAll('circle')
                        .data(nodes)
                        .join('circle')

                    // When mouse over change color and display their radius in a text
                    circle
                        .on('mouseover', function (e, d) {
                            d3.select(this)
                                .attr('fill', (d) => color(d.index + 1))

                            div.select('svg')
                                .append('text')
                                .attr('id', 'temp')
                                .attr('x', d.x)
                                .attr('y', d.y)
                                .style('font-size', `${d.radius / 1.5}px`)
                                .text(`${d.radius}px`)
                        })
                        .on('mouseout', function (e, d) {
                            d3.select('#temp').remove()
                            d3.select(this).attr('fill', (d) => {
                                return color(d.index)
                            })
                        })
                        .attr('fill', (d, i) => {
                            return color(i)
                        })
                        .attr('r', function (d) {
                            return d.radius
                        })
                        .attr('cx', function (d) {
                            return d.x
                        })
                        .attr('cy', function (d) {
                            return d.y
                        })

                }
                console.log('ready..')
            }

            // Calling The exercises
            exercise1();
            exercise2()
            exercise3()
            exercise4()
            exercise5()
            exercise6()
            exercise9()
            exercise10()
            exercise11()
            exercise12()
            exercise13()
            exercise14()
            exercise15()
            exercise18()
            exercise23()
            exercise24()
            exercise25()
            exercise26()
            exercise27()
            exercise28()
        })()
    </script>
</body>

</html>